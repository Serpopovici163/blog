---
layout: archive
title:  "Mining Rig Temperature Control"
classes: wide
---

## A solution for outdoor mining rigs during winter

I briefly decided to invest in a few graphics cards with all the recent hype surrounding cryptocurrencies and mining. I figured, with GPU prices today, it would be rather impossible to lose money from such an investment and I wanted to try my hand out at mining. Luckily, I began mining just as temperatures began dropping in Canada and considering that I live in an apartment, it made sense to place my mining rig outdoors.
![Enclosure diagram](/assets/img/mining-rig/basic-diagram.PNG){: style="float: right; width:50%; height:50%"}
Firstly, I constructed a relatively waterproof enclosure for the rig to protect it from rain and snow while it sits on my balcony. This enclosure uses three 120mm fans to pull cold air in at the bottom which naturally flows upwards and exits through the top of the enclosure. While this works well for colder temperatures, I have found that the lid of the enclosure must remain open for temperatures above ~ -10 C (lid is grey in the image above). Around -10 C and below, heat generated by the graphics cards is no longer enough to reliably maintain all the internals above 0 C and therefore I needed some way to cut off the influx of cold air when the internals got too cold.

# Basic Idea

I know from experimentation that having the enclosure's fans off results in incredibly hot temperatures so cutting off the fans should be enough to maintain the internals above 0 C. I purchased some cheap DHT11 temperature and humidity sensors off of AliExpress for another project a while ago so I will be using those for this application. To more accurately measure the temperature within the enclosure, three sensors will be used to measure the temperature at different points:
- (1) will monitor a known hotspot behind two GPUs
- (2) will monitor the motherboard
- (3) will monitor the temperature at the emptier end of the rig given the lack of GPUs which results in lower temps
**IMAGE**

## Logic

I am not monitoring humidity since I want the microcontroller to prioritize temperature over humidity and Canada's winters are traditionally dry. The microcontroller will average the temperature across all three DHTs and cut off fans whenever this average dips below 10 C. Furthermore, the fans will cut off if any sensor dips below 5 C; the thresholds are high because I do not trust the accuracy of my cheap AliExpress DHTs.

## Build

I am using an ESP-12E, since that is what I have on hand, as well as a cheap 4-channel relay board in conjunction with the three DHT sensors. Connections are as follows:
- Motherboard DHT --> digital pin 5
- GPU DHT --> digital pin 4
- PSU DHT --> digital pin 0
- Fan relay --> digital pin 16

## Code

The code can be found at https://github.com/Serpopovici163/miningRigTempCtrl and the ESP's webpage: 
![Wepbage screenshot](/assets/img/mining-rig/webpage.PNG)
The webpage automatcally refreshes every 30 seconds and I am currently displaying it on a Wink Relay in my living room seeing as that's about the only thing a Wink Relay is good for nowadays. One note from the screenshot above is that the low temperature saved by the ESP is wrong: there seems to be some issue with at least one sensor causing it to briefly report a temperature of -21 Celsius but the enclosure never actually drops below 0 Celsius.

# UPDATE Dec 2021

Everything works as intended! The rig manages its temperature accurately and has been up for 24/7 with this system installed.